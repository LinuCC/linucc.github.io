<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>LinuCC&#39;s Sandbox</title>
    <description></description>
    <link>linucc.github.io/</link>
    <atom:link href="linucc.github.io/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Wed, 20 May 2015 02:36:24 +0200</pubDate>
    <lastBuildDate>Wed, 20 May 2015 02:36:24 +0200</lastBuildDate>
    <generator>Jekyll v2.4.0</generator>
    
      <item>
        <title>Doctrine2 Three-way many-to-many table result offset</title>
        <description>&lt;p&gt;There seems to be a bug with doctrine 2 when using a table looking like this:&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;a_id&lt;/td&gt;
      &lt;td&gt;b_id&lt;/td&gt;
      &lt;td&gt;c_id&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Here we have three foreign keys to other tables.
Together they are also the primary key of the table.&lt;/p&gt;

&lt;p&gt;Now lets say we want to fetch all entries joined with the entries of table &lt;code&gt;C&lt;/code&gt; using DQL:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-php&quot;&gt;$query = $this-&amp;gt;_em-&amp;gt;createQuery(
  &#39;SELECT connector, c
  FROM Connector connector
  INNER JOIN connector.c c
&#39;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;I would expect something like this result with &lt;code&gt;Query::HYDRATE_ARRAY&lt;/code&gt;:&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;connector.a_id&lt;/td&gt;
      &lt;td&gt;connector.b_id&lt;/td&gt;
      &lt;td&gt;connector.c_id&lt;/td&gt;
      &lt;td&gt;c.id&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Instead, I get this:&lt;/p&gt;

&lt;table&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;connector.a_id&lt;/td&gt;
      &lt;td&gt;connector.b_id&lt;/td&gt;
      &lt;td&gt;connector.c_id&lt;/td&gt;
      &lt;td&gt;c.id&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;3&lt;/td&gt;
      &lt;td&gt;null&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The data of table &lt;code&gt;C&lt;/code&gt; are all displaced by 1 row, with the last row not having any data.
This also applies to the object hydration.&lt;/p&gt;

&lt;p&gt;It seems to be a problem related to the composite primary key.
Luckily I have access to the database itself, so I could circumvent the problem by adding an additional &lt;code&gt;id&lt;/code&gt;-column to the table, and making that one the primary key.&lt;/p&gt;
</description>
        <pubDate>Sat, 28 Mar 2015 00:00:00 +0100</pubDate>
        <link>linucc.github.io/doctrine2-threeway-id</link>
        <guid isPermaLink="true">linucc.github.io/doctrine2-threeway-id</guid>
        
        <category>doctrine2</category>
        
        <category>dql</category>
        
        
      </item>
    
      <item>
        <title>Docker with Arch Linux and Raspberry Pi 2</title>
        <description>&lt;p&gt;The new and faster Raspberry Pi 2 finally allows more sophisticated usage of services for home media and networking.
Combine that with the superfast &lt;a href=&quot;https://www.docker.com/&quot;&gt;Docker&lt;/a&gt; for better service management and &lt;a href=&quot;https://consul.io/&quot;&gt;Consul&lt;/a&gt; for health checks and you get an awesome system that is really fun to play with (and possibly a bit overkill ;) )!&lt;/p&gt;

&lt;p&gt;I have used the first version of the Raspberry Pi for many tasks.
It was a print-server with cups, a media-center with minidlna and shared files with samba.
It is small, configurable and power-saving.
It also has tons of documentation available online.
The major downside of the Raspberry Pi v1 is its limited ressources:
If I use two services at the same time, it gets really slow with a 700Mhz ARMv6 processor.
Granted, with its 40â‚¬ price tag this is to be expected.
Now along comes the shiny new Raspberry Pi v2.
With a quad-core 900Mhz and 1GB of RAM it should be much faster than its predecessor.
The new processor also features the ARMv7 processor generation, meaning more software will be compatible with the new Raspberry Pi.&lt;/p&gt;

&lt;h2 id=&quot;basic-setup&quot;&gt;Basic setup&lt;/h2&gt;

&lt;h3 id=&quot;arch-linux&quot;&gt;Arch Linux&lt;/h3&gt;

&lt;p&gt;Installing Arch Linux on the Raspberry Pi is pretty straightforward.
Just follow the &lt;a href=&quot;http://archlinuxarm.org/platforms/armv7/broadcom/raspberry-pi-2&quot;&gt;guide on archlinuxarm.org&lt;/a&gt;.
If you have an older installation of Arch for the old Raspberry Pi, I recommend you create a fresh installation.
This way you dont need to use the armv6-packages (Possible dependency-hell) or upgrade them to armv7.&lt;/p&gt;

&lt;h3 id=&quot;docker&quot;&gt;Docker&lt;/h3&gt;

&lt;p&gt;To install Docker, login to your Raspberry Pi with SSH and type &lt;code&gt;pacman -Syu docker&lt;/code&gt; to update the system and install docker.&lt;br /&gt;
If you are logged in with a different user than root, you need to add yourself to the docker-group with &lt;code&gt;gpasswd -a user docker&lt;/code&gt; and switch to the group with &lt;code&gt;newgrp docker&lt;/code&gt;.
Note that the last command will only affect the current session.
Now you only need to start docker &lt;code&gt;systemctl start docker&lt;/code&gt; and optionally autostart it on boot with &lt;code&gt;systemctl enable docker&lt;/code&gt;.
Check if docker is up and running with &lt;code&gt;docker info&lt;/code&gt;.
Thats it!&lt;/p&gt;

&lt;h2 id=&quot;base-image-for-docker&quot;&gt;Base image for Docker&lt;/h2&gt;

&lt;p&gt;Since the Raspberry Pi 2 uses a different architecture than the old Raspberry Pi, the kernel differs, too.
This means that we cannot use already existing, prepackaged docker-images for Arch Linux like the repository &lt;a href=&quot;https://registry.hub.docker.com/u/cellofellow/rpi-arch/&quot;&gt;cellofellow/rpi-arch&lt;/a&gt;.
Since there is no base-image for Arch Linux on the Raspberry Pi 2 (I still struggle to create a working and small automatically building image), we have to create it ourselves.&lt;/p&gt;

&lt;p&gt;To do that, create a new directory on the Raspberry Pi to store the Dockerfile in.
Fetch the current Arch Linux archive with&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;curl -L http://archlinuxarm.org/os/ArchLinuxARM-rpi-2-latest.tar.gz -o archlinux.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Then create a new file named &lt;code&gt;Dockerfile&lt;/code&gt; with the following content:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;FROM scratch

ADD archlinux.tar.gz /

CMD [&quot;/bin/bash&quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Running &lt;code&gt;docker build -t base-arch-rpi2 .&lt;/code&gt; will extract the archive into the root of the new image named &lt;code&gt;base-arch-rpi2&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;You can now start a container using the image with &lt;code&gt;docker run -ti base-arch-rpi2&lt;/code&gt; or create children with &lt;code&gt;FROM base-arch-rpi2&lt;/code&gt; in your Dockerfile.&lt;/p&gt;
</description>
        <pubDate>Mon, 02 Mar 2015 00:00:00 +0100</pubDate>
        <link>linucc.github.io/docker-arch-rpi2</link>
        <guid isPermaLink="true">linucc.github.io/docker-arch-rpi2</guid>
        
        <category>docker</category>
        
        <category>raspberry-pi-2</category>
        
        <category>arch-linux</category>
        
        
      </item>
    
  </channel>
</rss>
